# Introduction: Orthology of genes


Orthology is a key concept in evolutionary biology that describes the relationship between genes in different species 
that have descended from a common ancestral gene. 
Orthologous genes are genes that have evolved from a single gene in the last common ancestor of the species being 
compared and typically retain similar functions across different species. 
The study of orthology is crucial for understanding the evolutionary history of genes and species, as well as for 
inferring gene function across different organisms. 
Orthologous genes are usually identified by comparing the DNA or protein sequences of genes across different species,
and genes that share a high degree of sequence similarity and are found in conserved genomic regions are likely to be 
orthologs. 
It is essential to distinguish between orthologs and paralogs, which are genes that have originated from a duplication 
event within a species, as paralogs may have diverged functionally. Comparative genomics approaches, such as 
phylogenetic analysis and synteny mapping, are commonly used to infer orthology relationships. 

### The Project: "Orthology Recap"
This project explores the potential of large language model (LLM) gene embeddings in capturing 
orthology relationships between human and mouse genes. Orthology refers to the evolutionary relationship between genes 
in different species that have descended from a common ancestral gene. By comparing gene embeddings generated by LLMs, 
we aim to investigate whether these embeddings can effectively mirror the orthology of the given genes.
LLMs have demonstrated remarkable capabilities in various tasks, and this project seeks to assess their usability in 
biomedical research, specifically in the context of orthology analysis. To accomplish this, we utilize data from the 
Monarch Knowledge Graph (KG), which provides a comprehensive resource for biomedical information.

### Key steps:

**1. Embedding Generation**: For each gene, we retrieve all associated phenotype descriptions from the Human Phenotype Ontology
(HPO). These descriptions are then fed into an LLM to generate phenotype embeddings for each gene.

**2. Embedding Storag**e: The generated gene embeddings are stored in the ChromaDB vector database, which provides efficient 
storage and retrieval capabilities for high-dimensional vectors.

**3. Orthology Comparison**: We employ cosine similarity, a commonly used metric for comparing vectors, to measure the 
similarity between gene embeddings. By comparing the embeddings of human and mouse genes, we can assess whether the 
LLM-generated embeddings capture the orthology relationships between the genes.

The project offers a user-friendly interface that allows for both pairwise comparison of individual genes 
and comparison of gene sets.

By leveraging the power of LLMs and the rich information provided by the Monarch KG, this project aims to explore the 
potential of LLM gene embeddings in capturing functional similarities between genes across species. The project's 
findings could have implications for advancing biomedical research, particularly in the context of differential 
diagnosis tasks.

### Using the CLI
The project provides a command-line interface (CLI) that allows researchers to generate gene embeddings and perform orthology comparisons. Here's a step-by-step guide on how to use the CLI:

## Generating Gene Embeddings:

To generate gene embeddings, use the `make_gene_embeddings` command.
You can specify the gene and phenotype prefixes for human or mouse genes using the `--gene_prefix` and `--phenotype_prefix` options.
If you have a specific list of genes, provide the path to the gene list file using the `--gene_list_file` option. If you dont add a list 
it will automatically put all genes with phenotypes into a collection (following the `--gene_prefix` and `--phenotype_prefix` options)
Choose whether to store the embeddings for individual genes or entire gene sets using the `--gene_by_gene`  or `--all` option. If `--all` is selected
there is no need for a `--gene_list_file`
Example command:

For a list of genes (or lsit of just one):
```
curategpt make_gene_embeddings --monarch_url $URL --path /path/to/db --collection ont_hp --gene_prefix HGNC: 
--phenotype_prefix HP: --gene_list_file /path/to/file --upsert gene_by_gene 
```

For a all genes with phenotypes from the KG:
```
curategpt make_gene_embeddings --monarch_url $URL --path /path/to/db --collection ont_hp --gene_prefix HGNC: 
--phenotype_prefix HP: --upsert all
```


### Comparing Gene Embeddings:

To compare gene embeddings, use the `gene_orthology` command.
Specify the collections containing the gene embeddings using the `--collection_one` and `--collection_two` options.
Provide a file containing the gene pairs you want to compare using the `--gene_pairs_file` option. If you dont provide 
a file it will automatically generate `1000_orthologous_pairs` and `1000_non_orthologous_pairs` from the subset of genes that have phenotypes in the KG. 

The file should have the following format:
```
[('HGNC:1723', 'MGI:1859866'), ('HGNC:19989', 'MGI:2139135'), ...]
```

Example command with `gene_pairs_file`:
```
curategpt gene_orthology -u $DATA_URL --collection_one human_genes --collection_two mouse_genes --gene_pairs_file /path/to/file --comparison_mode pairwise --output_file_one results.tsv
```

Example command with no file using `1000_orthologous_pairs` and `1000_non_orthologous_pairs`:
```
curategpt gene_orthology u $DATA_URL --collection_one human_genes --collection_two mouse_genes --output_file_one orth_cosim.tsv --output_file_two non_orth_cosim.tsv
```


### Output
The CLI generates a TSV file containing the comparison results. Each row in the file represents a gene pair, and the 
columns include the gene identifiers and the cosine similarity score between their embeddings.




